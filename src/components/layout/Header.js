import React, { useState } from "react";
import { useRef } from "react";
import { useToggleButton } from "@react-aria/button";
import { useToggleState } from "@react-stately/toggle";
import PropTypes from "prop-types";
import { AddTask } from "../AddTask";

export const Header = ({ darkMode, setDarkMode, ...props }) => {
  /**
   * @type {React.MutableRefObject<HTMLButtonElement>}
   */
  const ref = useRef();
  const state = useToggleState(props);
  const { buttonProps } = useToggleButton(props, state, ref);
  const [shouldShowMain, setShouldShowMain] = useState(false);
  const [showQuickAddTask, setShowQuickAddTask] = useState(false);

  return (
    <header className="header" data-testid="header">
      <nav>
        <div className="logo">
          <h1 className="app-title">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 72 16">
              <path
                className="logo__path"
                fill="var(--logo-color, black)"
                d="M20.812 12.51h-1.528V4.99c0-.512.095-.94.285-1.287.194-.351.471-.616.83-.793.36-.182.785-.273 1.275-.273.152 0 .303.01.45.032.148.017.292.044.432.082l-.038 1.18a1.756 1.756 0 0 0-.28-.045 3.68 3.68 0 0 0-.316-.012 1.28 1.28 0 0 0-.603.133.879.879 0 0 0-.38.374 1.324 1.324 0 0 0-.127.609v7.52Zm1.414-6.86v1.115H18.23V5.65h3.995Zm3.982 6.987c-.507 0-.966-.082-1.376-.247a3.038 3.038 0 0 1-1.04-.704 3.12 3.12 0 0 1-.653-1.059 3.708 3.708 0 0 1-.228-1.313v-.253c0-.537.078-1.023.234-1.459a3.31 3.31 0 0 1 .654-1.116c.279-.313.608-.551.989-.716a3.07 3.07 0 0 1 1.236-.248c.49 0 .92.083 1.287.248.368.165.673.397.914.697.245.296.427.65.545 1.06.123.41.184.862.184 1.356v.653h-5.301V8.44h3.792v-.12a2.148 2.148 0 0 0-.165-.774 1.315 1.315 0 0 0-.45-.583c-.203-.148-.474-.222-.812-.222-.254 0-.48.055-.679.165-.194.105-.357.26-.488.463a2.44 2.44 0 0 0-.304.735 4.136 4.136 0 0 0-.102.958v.253c0 .3.04.58.12.838.085.253.208.475.369.665.16.19.355.34.583.45.228.106.488.159.78.159.368 0 .695-.074.983-.222.287-.148.537-.357.748-.628l.805.78a3.14 3.14 0 0 1-.577.622 2.888 2.888 0 0 1-.868.475 3.456 3.456 0 0 1-1.18.184Zm6.962 0c-.507 0-.965-.082-1.375-.247a3.038 3.038 0 0 1-1.04-.704 3.12 3.12 0 0 1-.653-1.059 3.708 3.708 0 0 1-.229-1.313v-.253c0-.537.078-1.023.235-1.459.156-.435.374-.807.653-1.116.28-.313.609-.551.99-.716a3.07 3.07 0 0 1 1.236-.248c.49 0 .92.083 1.287.248.368.165.672.397.913.697.245.296.427.65.546 1.06.122.41.183.862.183 1.356v.653h-5.3V8.44h3.791v-.12a2.146 2.146 0 0 0-.165-.774 1.315 1.315 0 0 0-.45-.583c-.203-.148-.473-.222-.812-.222-.253 0-.48.055-.678.165-.194.105-.357.26-.488.463a2.44 2.44 0 0 0-.305.735 4.136 4.136 0 0 0-.101.958v.253c0 .3.04.58.12.838a2 2 0 0 0 .368.665c.16.19.355.34.584.45.228.106.488.159.78.159.367 0 .695-.074.982-.222.288-.148.537-.357.749-.628l.805.78c-.148.216-.34.423-.577.622a2.888 2.888 0 0 1-.869.475 3.456 3.456 0 0 1-1.18.184Zm8.124-1.547V2.77h1.534v9.74H41.44l-.146-1.42ZM36.83 9.156v-.133c0-.52.06-.994.184-1.42.122-.432.3-.802.532-1.11a2.34 2.34 0 0 1 .85-.717c.334-.169.71-.254 1.129-.254.414 0 .777.08 1.09.241.313.161.58.391.8.692.219.295.395.65.526 1.065.13.41.224.867.278 1.37v.424a6.74 6.74 0 0 1-.279 1.345 3.61 3.61 0 0 1-.526 1.052c-.22.296-.488.525-.805.685a2.38 2.38 0 0 1-1.097.241 2.4 2.4 0 0 1-1.123-.26 2.48 2.48 0 0 1-.843-.729 3.433 3.433 0 0 1-.532-1.103 5.014 5.014 0 0 1-.184-1.39Zm1.528-.133v.133c0 .313.027.604.082.875.06.27.15.51.273.716.123.204.281.364.475.482.2.115.436.172.71.172.347 0 .633-.076.857-.229.224-.152.4-.357.526-.615a2.86 2.86 0 0 0 .266-.875V8.534a2.805 2.805 0 0 0-.158-.697 1.865 1.865 0 0 0-.31-.564 1.309 1.309 0 0 0-.49-.38 1.53 1.53 0 0 0-.678-.14c-.279 0-.515.059-.71.177a1.44 1.44 0 0 0-.482.488 2.4 2.4 0 0 0-.272.723 4.18 4.18 0 0 0-.09.882Zm11.376 2.27v1.217h-5.111v-1.217h5.11Zm-.14-4.693-4.451 5.91h-.99v-.982l4.427-5.879h1.014V6.6Zm-.59-.95v1.217H44.23V5.649h4.775Zm5.822 5.484V7.862c0-.245-.045-.456-.133-.634a.933.933 0 0 0-.406-.412c-.178-.097-.402-.146-.672-.146-.25 0-.465.042-.647.127a1.046 1.046 0 0 0-.425.342.826.826 0 0 0-.152.489h-1.522c0-.27.065-.533.197-.787a2.1 2.1 0 0 1 .57-.678 2.85 2.85 0 0 1 .894-.47 3.718 3.718 0 0 1 1.167-.17c.516 0 .972.086 1.37.26.401.173.716.435.945.786.232.346.348.782.348 1.306v3.05c0 .313.022.594.064.843.046.246.112.46.196.64v.102h-1.566a2.712 2.712 0 0 1-.171-.627 5.133 5.133 0 0 1-.057-.749Zm.222-2.796.012.945h-1.097c-.283 0-.532.027-.748.082a1.53 1.53 0 0 0-.539.228.992.992 0 0 0-.323.368 1.076 1.076 0 0 0-.108.489c0 .181.042.348.127.5a.89.89 0 0 0 .367.35c.165.084.364.126.597.126.312 0 .585-.063.818-.19.236-.131.422-.29.558-.476.135-.19.207-.37.215-.539l.495.679a2.32 2.32 0 0 1-.26.558 2.705 2.705 0 0 1-.482.57 2.398 2.398 0 0 1-1.642.609c-.449 0-.848-.089-1.199-.266a2.131 2.131 0 0 1-.824-.73 1.89 1.89 0 0 1-.298-1.046c0-.363.067-.684.203-.963.14-.284.342-.52.608-.71.27-.19.6-.335.99-.432a5.291 5.291 0 0 1 1.331-.152h1.199Zm4.546-2.688v6.86H58.06V5.65h1.534Zm-1.636-1.802c0-.232.076-.424.229-.577.156-.156.372-.234.646-.234.27 0 .484.078.64.234a.771.771 0 0 1 .235.577.764.764 0 0 1-.234.571c-.157.152-.37.228-.64.228-.275 0-.491-.076-.647-.228a.774.774 0 0 1-.229-.57Zm7.159 6.804a.765.765 0 0 0-.114-.412c-.076-.127-.222-.24-.437-.342-.212-.102-.524-.195-.939-.28a8.09 8.09 0 0 1-1.002-.285 3.178 3.178 0 0 1-.773-.412 1.735 1.735 0 0 1-.501-.57 1.58 1.58 0 0 1-.178-.761c0-.28.061-.544.184-.793.123-.25.298-.47.526-.66.229-.19.506-.34.831-.45.33-.11.698-.165 1.104-.165.574 0 1.067.098 1.477.292.414.19.731.45.951.78.22.326.33.693.33 1.103h-1.528a.975.975 0 0 0-.14-.507.972.972 0 0 0-.406-.387c-.181-.101-.41-.152-.684-.152-.263 0-.48.042-.654.127a.894.894 0 0 0-.38.317.81.81 0 0 0-.057.742.731.731 0 0 0 .228.247c.106.072.25.14.431.203.186.064.419.125.698.184.524.11.974.252 1.35.425.381.169.673.389.876.66.203.266.304.604.304 1.014a1.8 1.8 0 0 1-.197.837c-.126.25-.312.467-.558.653a2.803 2.803 0 0 1-.881.425 3.966 3.966 0 0 1-1.141.152c-.622 0-1.148-.11-1.58-.33-.43-.224-.758-.509-.982-.856-.22-.35-.33-.714-.33-1.09h1.477c.017.283.096.51.235.678.144.165.321.286.533.362.215.072.437.107.666.107.274 0 .505-.035.69-.107a.993.993 0 0 0 .426-.305.726.726 0 0 0 .145-.444Zm5.98-5.002v1.115H67.23V5.65h3.868Zm-2.752-1.681h1.528v6.645c0 .212.03.374.09.489.063.11.15.184.26.222.109.038.238.057.386.057a3.008 3.008 0 0 0 .539-.057l.006 1.166a3.912 3.912 0 0 1-.444.102c-.164.03-.355.044-.57.044-.351 0-.662-.061-.933-.184a1.372 1.372 0 0 1-.634-.615c-.152-.283-.228-.66-.228-1.128V3.969ZM14 3.226 6.013 11.22 3.045 8.252l.987-.987 1.981 1.981 7-7 .987.98Zm-1.547 3.528c.091.399.147.819.147 1.246 0 3.094-2.506 5.6-5.6 5.6A5.598 5.598 0 0 1 1.4 8c0-3.094 2.506-5.6 5.6-5.6 1.106 0 2.128.322 2.996.875l1.008-1.008A6.93 6.93 0 0 0 7 1C3.136 1 0 4.136 0 8s3.136 7 7 7 7-3.136 7-7a7.02 7.02 0 0 0-.42-2.373l-1.127 1.127Z"
              />
            </svg>
            <span className="sr-only">Feedzaist</span>
          </h1>
        </div>
        <div className="settings">
          <ul>
            <li className="settings__add">
              <button
                className="settings__add__button"
                data-testid="quick-add-task-action"
                aria-label="Quick add task"
                type="button"
                onClick={() => {
                  setShowQuickAddTask(true);
                  setShouldShowMain(true);
                }}
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    fill="var(--logo-color)"
                    d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"
                  />
                </svg>
              </button>
            </li>
            <li className="settings__darkmode">
              <button
                {...buttonProps}
                ref={ref}
                data-testid="dark-mode-action"
                aria-label="Darkmode on/off"
                type="button"
                onClick={() => {
                  setDarkMode(!darkMode);
                }}
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    fill="var(--logo-color)"
                    d="M12 4.81V19c-3.31 0-6-2.63-6-5.87 0-1.56.62-3.03 1.75-4.14L12 4.81M6.35 7.56C4.9 8.99 4 10.96 4 13.13 4 17.48 7.58 21 12 21s8-3.52 8-7.87c0-2.17-.9-4.14-2.35-5.57L12 2 6.35 7.56z"
                  />
                </svg>
              </button>
            </li>
          </ul>
        </div>
      </nav>

      <AddTask
        showAddTaskMain={false}
        shouldShowMain={shouldShowMain}
        showQuickAddTask={showQuickAddTask}
        setShowQuickAddTask={setShowQuickAddTask}
      />
    </header>
  );
};

Header.propTypes = {
  darkMode: PropTypes.bool.isRequired,
  setDarkMode: PropTypes.func.isRequired,
};
